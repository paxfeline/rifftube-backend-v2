{"ast":null,"code":"import _classCallCheck from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{Redirect}from'react-router-dom';import YouTubeVideo from'../YouTubeVideo/YouTubeVideo';import Login from'../Login/Login';import EditControls from'./EditControls';import{setVideoID,setWebSocket,getRiffsMeta,getRiffs,setRecorder}from'../../actions';import MetaBar from'../MetaBar';import NavBar from'../NavBar.js';var EditInterface=/*#__PURE__*/function(_React$Component){_inherits(EditInterface,_React$Component);var _super=_createSuper(EditInterface);function EditInterface(props){var _this;_classCallCheck(this,EditInterface);_this=_super.call(this,props);_this.componentDidMount=function(){if(_this.props.match.params.videoID){_this.props.setVideoID(_this.props.match.params.videoID,_this.props.googleUser);_this.videoIDRef.current.value=_this.props.match.params.videoID;}};_this.componentDidUpdate=function(prevProps,prevState){if(_this.props.match.params.videoID!==_this.props.videoID){_this.props.setVideoID(_this.props.match.params.videoID,_this.props.googleUser);_this.videoIDRef.current.value=_this.props.match.params.videoID;}if(_this.loggedIn()&&_this.props.videoID&&_this.props.googleUser!==prevProps.googleUser){_this.props.getRiffs(_this.props.videoID,_this.props.googleUser);}if(_this.loggedIn()&&(!_this.props.websocket||_this.props.videoID!==prevProps.videoID)){//const websocket = new WebSocket( `ws://localhost:3300/riff?videoID=${this.props.match.params.videoID}&googleToken=${this.props.googleUser.getAuthResponse().id_token}` );\nvar baseURL;if(process.env.NODE_ENV==='production')baseURL='wss://rifftube.herokuapp.com';else baseURL='ws://localhost:3300';var websocket=new WebSocket(\"\".concat(baseURL,\"/riff?videoID=\").concat(_this.props.match.params.videoID,\"&googleToken=\").concat(_this.props.googleUser.getAuthResponse().id_token));websocket.onmessage=function(event){console.log(event.data);var msg=JSON.parse(event.data);if(msg.video_id===_this.props.videoID&&msg.type==='update')_this.props.getRiffsMeta(_this.props.videoID);};_this.props.setWebSocket(websocket);}};_this.loggedIn=function(){if(_this.props.googleUser)return _this.props.googleUser.isSignedIn();return false;};_this.authCheck=function(Component,DefaultComponent){return _this.loggedIn()?/*#__PURE__*/React.createElement(Component,null):/*#__PURE__*/React.createElement(DefaultComponent,null);};_this.extractVideoID=function(url){var regExp=/^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;var match=url.match(regExp);if(match&&match[7].length===11){return match[7];}else{return url;// if extraction fails, fallback on assuming they gave an ID\n}};_this.videoIDRef=React.createRef();return _this;}_createClass(EditInterface,[{key:\"render\",value:function render(){var _this2=this;return this.props.match.params.videoID?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(NavBar,{color:\"grey\"}),/*#__PURE__*/React.createElement(\"div\",{className:\"youtube-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"top-section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title-and-url\"},/*#__PURE__*/React.createElement(\"h1\",{className:\"heading-primary-main\"},\"RiffTube\"))),/*#__PURE__*/React.createElement(\"h4\",{className:\"get-started-instructions\"},this.loggedIn()?null:/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Login,null),\" \",/*#__PURE__*/React.createElement(\"p\",null,\"to get started\"))),/*#__PURE__*/React.createElement(\"label\",null,\"Paste any YouTube URL here \\u2192 \"),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",defaultValue:this.props.videoID,ref:this.videoIDRef}),/*#__PURE__*/React.createElement(\"button\",{className:\"btn\",id:\"change-video-btn\",onClick:function onClick(e){var vID=_this2.extractVideoID(_this2.videoIDRef.current.value);_this2.props.history.push(\"/riff/\".concat(vID));_this2.props.setVideoID(vID,_this2.props.googleUser);}},\"Change Video\"),/*#__PURE__*/React.createElement(YouTubeVideo,{id:this.props.videoID,riffs:this.props.riffs}),/*#__PURE__*/React.createElement(MetaBar,null),/*#__PURE__*/React.createElement(\"div\",{className:\"view-share-riff-link\"},/*#__PURE__*/React.createElement(\"a\",{href:'/view/'+this.props.videoID+(this.props.user_id?'?solo='+this.props.user_id:''),target:\"_blank\",rel:\"noopener noreferrer\"},\"View & Share Riffed Video\"))),this.loggedIn()?/*#__PURE__*/React.createElement(EditControls,null):null):/*#__PURE__*/React.createElement(Redirect,{to:\"/riff/\".concat(this.props.videoID)});}}]);return EditInterface;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{riffs:state.riffs.all,videoID:state.videoID,googleUser:state.googleUser,user_id:state.user_id,websocket:state.websocket,recorder:state.recorder};};var mapDispatchToProps={setVideoID:setVideoID,setWebSocket:setWebSocket,getRiffsMeta:getRiffsMeta,getRiffs:getRiffs,setRecorder:setRecorder};export default connect(mapStateToProps,mapDispatchToProps)(EditInterface);","map":{"version":3,"names":["React","connect","Redirect","YouTubeVideo","Login","EditControls","setVideoID","setWebSocket","getRiffsMeta","getRiffs","setRecorder","MetaBar","NavBar","EditInterface","props","componentDidMount","match","params","videoID","googleUser","videoIDRef","current","value","componentDidUpdate","prevProps","prevState","loggedIn","websocket","baseURL","process","env","NODE_ENV","WebSocket","getAuthResponse","id_token","onmessage","event","console","log","data","msg","JSON","parse","video_id","type","isSignedIn","authCheck","Component","DefaultComponent","extractVideoID","url","regExp","length","createRef","e","vID","history","push","riffs","user_id","mapStateToProps","state","all","recorder","mapDispatchToProps"],"sources":["/Users/davidnewberry/Documents/test_rails/frontend/src/components/RiffControls/EditInterface.js"],"sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport { Redirect } from 'react-router-dom';\nimport YouTubeVideo from '../YouTubeVideo/YouTubeVideo';\nimport Login from '../Login/Login';\nimport EditControls from './EditControls';\nimport {\n  setVideoID,\n  setWebSocket,\n  getRiffsMeta,\n  getRiffs,\n  setRecorder,\n} from '../../actions';\nimport MetaBar from '../MetaBar';\nimport NavBar from '../NavBar.js';\n\nclass EditInterface extends React.Component {\n  constructor(props) {\n    super(props);\n    this.videoIDRef = React.createRef();\n  }\n\n  componentDidMount = () => {\n    if (this.props.match.params.videoID) {\n      this.props.setVideoID(\n        this.props.match.params.videoID,\n        this.props.googleUser\n      );\n      this.videoIDRef.current.value = this.props.match.params.videoID;\n    }\n  };\n\n  componentDidUpdate = (prevProps, prevState) => {\n    if (this.props.match.params.videoID !== this.props.videoID) {\n      this.props.setVideoID(\n        this.props.match.params.videoID,\n        this.props.googleUser\n      );\n      this.videoIDRef.current.value = this.props.match.params.videoID;\n    }\n\n    if (\n      this.loggedIn() &&\n      this.props.videoID &&\n      this.props.googleUser !== prevProps.googleUser\n    ) {\n      this.props.getRiffs(this.props.videoID, this.props.googleUser);\n    }\n\n    if (\n      this.loggedIn() &&\n      (!this.props.websocket || this.props.videoID !== prevProps.videoID)\n    ) {\n      //const websocket = new WebSocket( `ws://localhost:3300/riff?videoID=${this.props.match.params.videoID}&googleToken=${this.props.googleUser.getAuthResponse().id_token}` );\n      var baseURL;\n      if (process.env.NODE_ENV === 'production')\n        baseURL = 'wss://rifftube.herokuapp.com';\n      else baseURL = 'ws://localhost:3300';\n\n      const websocket = new WebSocket(\n        `${baseURL}/riff?videoID=${\n          this.props.match.params.videoID\n        }&googleToken=${this.props.googleUser.getAuthResponse().id_token}`\n      );\n      websocket.onmessage = (event) => {\n        console.log(event.data);\n\n        const msg = JSON.parse(event.data);\n\n        if (msg.video_id === this.props.videoID && msg.type === 'update')\n          this.props.getRiffsMeta(this.props.videoID);\n      };\n      this.props.setWebSocket(websocket);\n    }\n  };\n\n  loggedIn = () => {\n    if (this.props.googleUser) return this.props.googleUser.isSignedIn();\n\n    return false;\n  };\n\n  authCheck = (Component, DefaultComponent) => {\n    return this.loggedIn() ? <Component /> : <DefaultComponent />;\n  };\n  /* extracts the youtube id from a url. got help from: https://ctrlq.org/code/19797-regex-youtube-id */\n  extractVideoID = (url) => {\n    var regExp =\n      /^.*((youtu.be\\/)|(v\\/)|(\\/u\\/\\w\\/)|(embed\\/)|(watch\\?))\\??v?=?([^#&?]*).*/;\n    var match = url.match(regExp);\n    if (match && match[7].length === 11) {\n      return match[7];\n    } else {\n      return url; // if extraction fails, fallback on assuming they gave an ID\n    }\n  };\n\n  render() {\n    return this.props.match.params.videoID ? (\n      <React.Fragment>\n        <NavBar color=\"grey\" />\n        <div className=\"youtube-section\">\n          <div className=\"top-section\">\n            <div className=\"title-and-url\">\n              <h1 className=\"heading-primary-main\">RiffTube</h1>\n            </div>\n          </div>\n          <h4 className=\"get-started-instructions\">\n            {this.loggedIn() ? null : (\n              <React.Fragment>\n                <Login /> <p>to get started</p>\n              </React.Fragment>\n            )}\n          </h4>\n          <label>Paste any YouTube URL here &#8594; </label>\n          <input\n            type=\"text\"\n            defaultValue={this.props.videoID}\n            ref={this.videoIDRef}\n          />\n          <button className=\"btn\" id=\"change-video-btn\" onClick={(e) => {\n              const vID = this.extractVideoID(this.videoIDRef.current.value);\n\n              this.props.history.push(`/riff/${vID}`);\n\n              this.props.setVideoID(vID, this.props.googleUser);\n            }}>\n            Change Video\n          </button>\n          <YouTubeVideo id={this.props.videoID} riffs={this.props.riffs} />\n          <MetaBar />\n          <div className=\"view-share-riff-link\">\n            <a\n              href={\n                '/view/' +\n                this.props.videoID +\n                (this.props.user_id ? '?solo=' + this.props.user_id : '')\n              }\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              View &amp; Share Riffed Video\n            </a>\n          </div>\n        </div>\n        {this.loggedIn() ? <EditControls /> : null}\n      </React.Fragment>\n    ) : (\n      <Redirect to={`/riff/${this.props.videoID}`} />\n    );\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  riffs: state.riffs.all,\n  videoID: state.videoID,\n  googleUser: state.googleUser,\n  user_id: state.user_id,\n  websocket: state.websocket,\n  recorder: state.recorder,\n});\n\nconst mapDispatchToProps = {\n  setVideoID,\n  setWebSocket,\n  getRiffsMeta,\n  getRiffs,\n  setRecorder,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(EditInterface);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}