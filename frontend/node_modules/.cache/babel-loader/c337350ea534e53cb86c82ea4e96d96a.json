{"ast":null,"code":"import _classCallCheck from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/davidnewberry/Documents/test_rails/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import{setImmediateOff}from'../../actions/index.js';var Record=/*#__PURE__*/function(_React$Component){_inherits(Record,_React$Component);var _super=_createSuper(Record);function Record(props){var _this;_classCallCheck(this,Record);_this=_super.call(this,props);_this.endRecord=function(){if(_this.props.recorder==null)return;// do nothing if recording isn't yet allowed\n_this.setState({recordingState:false});_this.duration=(Date.now()-_this.startTime)/1000;// experimenting this.state.gumStream.getAudioTracks()[0].stop();\n_this.props.recorder.finishRecording();// create new stream -- NEEDED???? experimenting\n/*navigator.mediaDevices\n      .getUserMedia({ audio: true, video: false })\n      .then((stream) => {\n        this.setState({ gumStream: stream });\n      })\n      .catch(function (err) {\n        //enable the record button if getUSerMedia() fails\n        console.log(\"oops, can't get stream\", err);\n      });\n      */};_this.startRecord=function(){if(_this.props.recorder==null)return;// do nothing if recording isn't yet allowed\n_this.setState({recordingState:true});_this.startTime=Date.now();//this.state.mediaRecorder.start();\n_this.props.recorder.onComplete=function(recorder,blob){//createDownloadLink(blob, recorder.encoding);\n_this.props.saveTempAudio(blob,_this.duration);};_this.props.recorder.setOptions({timeLimit:120,encodeAfterRecord:true,mp3:{bitRate:160}});//start the recording process\nsetTimeout(function(){return _this.props.recorder.startRecording();},200);// delay start to avoid clicks and taps\n};_this.state={recordingState:false};return _this;}// arrow classes bind the methods properly\n_createClass(Record,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;console.log(\"record CDM\",this.props.userMedia);if(this.props.immediateRecord){console.log(\"start immediately\");this.startRecord();setImmediateOff();window.addEventListener('keyup',function(e){if(e.key=='r')_this2.endRecord();});}}},{key:\"render\",value:function render(){var ret;// var for the value to be returned\nif(navigator.mediaDevices){if(!this.state.recordingState){ret=/*#__PURE__*/React.createElement(\"button\",{id:\"recordBtn\",onClick:this.startRecord},\"Record\");}else{ret=/*#__PURE__*/React.createElement(\"button\",{id:\"stopBtn\",onClick:this.endRecord},\"stop\");}}else ret=/*#__PURE__*/React.createElement(\"span\",null,\"Your device is not supported by navigator.mediaDevices. Sorry.\");return/*#__PURE__*/React.createElement(React.Fragment,null,ret);}}]);return Record;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{immediateRecord:state.immediateRecord,recorder:state.recorder};};var mapDispatchToProps={setImmediateOff:setImmediateOff};export default connect(mapStateToProps,mapDispatchToProps)(Record);","map":{"version":3,"names":["React","connect","setImmediateOff","Record","props","endRecord","recorder","setState","recordingState","duration","Date","now","startTime","finishRecording","startRecord","onComplete","blob","saveTempAudio","setOptions","timeLimit","encodeAfterRecord","mp3","bitRate","setTimeout","startRecording","state","console","log","userMedia","immediateRecord","window","addEventListener","e","key","ret","navigator","mediaDevices","Component","mapStateToProps","mapDispatchToProps"],"sources":["/Users/davidnewberry/Documents/test_rails/frontend/src/components/RiffControls/Record.js"],"sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport {\n  setImmediateOff,\n} from '../../actions/index.js';\n\nclass Record extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      recordingState: false,\n    };\n  }\n\n  // arrow classes bind the methods properly\n\n  endRecord = () => {\n    if (this.props.recorder == null) return; // do nothing if recording isn't yet allowed\n\n    this.setState({ recordingState: false });\n    this.duration = (Date.now() - this.startTime) / 1000;\n\n    // experimenting this.state.gumStream.getAudioTracks()[0].stop();\n    this.props.recorder.finishRecording();\n\n    // create new stream -- NEEDED???? experimenting\n    /*navigator.mediaDevices\n      .getUserMedia({ audio: true, video: false })\n      .then((stream) => {\n        this.setState({ gumStream: stream });\n      })\n      .catch(function (err) {\n        //enable the record button if getUSerMedia() fails\n        console.log(\"oops, can't get stream\", err);\n      });\n      */\n  }\n\n  componentDidMount() {\n    console.log(\"record CDM\", this.props.userMedia);\n    if ( this.props.immediateRecord )\n    {\n      console.log(\"start immediately\");\n      this.startRecord();\n      setImmediateOff();\n      window.addEventListener('keyup', (e) => { if (e.key == 'r') this.endRecord(); });\n    }\n  }\n\n\n  startRecord = () => {\n    if (this.props.recorder == null) return; // do nothing if recording isn't yet allowed\n\n    this.setState({ recordingState: true });\n    this.startTime = Date.now();\n    //this.state.mediaRecorder.start();\n    this.props.recorder.onComplete = (recorder, blob) => {\n      //createDownloadLink(blob, recorder.encoding);\n      this.props.saveTempAudio(blob, this.duration);\n    };\n    this.props.recorder.setOptions({\n      timeLimit: 120,\n      encodeAfterRecord: true,\n      mp3: {\n        bitRate: 160,\n      },\n    });\n\n    //start the recording process\n    setTimeout( () => this.props.recorder.startRecording(), 200 ); // delay start to avoid clicks and taps\n  }\n\n  render() {\n    var ret; // var for the value to be returned\n\n    if (navigator.mediaDevices) {\n      if (!this.state.recordingState) {\n        ret = (\n          <button\n            id=\"recordBtn\"\n            onClick={this.startRecord}\n          >\n            Record\n          </button>\n        );\n      } else {\n        ret = (\n          <button\n            id=\"stopBtn\"\n            onClick={this.endRecord}\n          >\n            stop\n          </button>\n        );\n      }\n    } else\n      ret = (\n        <span>\n          Your device is not supported by navigator.mediaDevices. Sorry.\n        </span>\n      );\n\n    return <React.Fragment>{ret}</React.Fragment>;\n  }\n}\n\n\n\nconst mapStateToProps = (state) => ({\n  immediateRecord: state.immediateRecord,\n  recorder: state.recorder,\n});\n\nconst mapDispatchToProps = {\n  setImmediateOff,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Record);\n"],"mappings":"opBAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,OAAO,KAAQ,aAAa,CACrC,OACEC,eAAe,KACV,wBAAwB,CAAC,GAE1BC,OAAM,4GACV,gBAAYC,KAAK,CAAE,wCACjB,uBAAMA,KAAK,EAAE,MASfC,SAAS,CAAG,UAAM,CAChB,GAAI,MAAKD,KAAK,CAACE,QAAQ,EAAI,IAAI,CAAE,OAAQ;AAEzC,MAAKC,QAAQ,CAAC,CAAEC,cAAc,CAAE,KAAM,CAAC,CAAC,CACxC,MAAKC,QAAQ,CAAG,CAACC,IAAI,CAACC,GAAG,EAAE,CAAG,MAAKC,SAAS,EAAI,IAAI,CAEpD;AACA,MAAKR,KAAK,CAACE,QAAQ,CAACO,eAAe,EAAE,CAErC;AACA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QACE,CAAC,OAcDC,WAAW,CAAG,UAAM,CAClB,GAAI,MAAKV,KAAK,CAACE,QAAQ,EAAI,IAAI,CAAE,OAAQ;AAEzC,MAAKC,QAAQ,CAAC,CAAEC,cAAc,CAAE,IAAK,CAAC,CAAC,CACvC,MAAKI,SAAS,CAAGF,IAAI,CAACC,GAAG,EAAE,CAC3B;AACA,MAAKP,KAAK,CAACE,QAAQ,CAACS,UAAU,CAAG,SAACT,QAAQ,CAAEU,IAAI,CAAK,CACnD;AACA,MAAKZ,KAAK,CAACa,aAAa,CAACD,IAAI,CAAE,MAAKP,QAAQ,CAAC,CAC/C,CAAC,CACD,MAAKL,KAAK,CAACE,QAAQ,CAACY,UAAU,CAAC,CAC7BC,SAAS,CAAE,GAAG,CACdC,iBAAiB,CAAE,IAAI,CACvBC,GAAG,CAAE,CACHC,OAAO,CAAE,GACX,CACF,CAAC,CAAC,CAEF;AACAC,UAAU,CAAE,iBAAM,OAAKnB,KAAK,CAACE,QAAQ,CAACkB,cAAc,EAAE,GAAE,GAAG,CAAE,CAAE;AACjE,CAAC,CA7DC,MAAKC,KAAK,CAAG,CACXjB,cAAc,CAAE,KAClB,CAAC,CAAC,aACJ,CAEA;AAAA,oDAwBA,4BAAoB,iBAClBkB,OAAO,CAACC,GAAG,CAAC,YAAY,CAAE,IAAI,CAACvB,KAAK,CAACwB,SAAS,CAAC,CAC/C,GAAK,IAAI,CAACxB,KAAK,CAACyB,eAAe,CAC/B,CACEH,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC,CAChC,IAAI,CAACb,WAAW,EAAE,CAClBZ,eAAe,EAAE,CACjB4B,MAAM,CAACC,gBAAgB,CAAC,OAAO,CAAE,SAACC,CAAC,CAAK,CAAE,GAAIA,CAAC,CAACC,GAAG,EAAI,GAAG,CAAE,MAAI,CAAC5B,SAAS,EAAE,CAAE,CAAC,CAAC,CAClF,CACF,CAAC,sBAyBD,iBAAS,CACP,GAAI6B,IAAG,CAAE;AAET,GAAIC,SAAS,CAACC,YAAY,CAAE,CAC1B,GAAI,CAAC,IAAI,CAACX,KAAK,CAACjB,cAAc,CAAE,CAC9B0B,GAAG,cACD,8BACE,EAAE,CAAC,WAAW,CACd,OAAO,CAAE,IAAI,CAACpB,WAAY,EAC3B,QAED,CACD,CACH,CAAC,IAAM,CACLoB,GAAG,cACD,8BACE,EAAE,CAAC,SAAS,CACZ,OAAO,CAAE,IAAI,CAAC7B,SAAU,EACzB,MAED,CACD,CACH,CACF,CAAC,IACC6B,IAAG,cACD,gCAAM,gEAEN,CACD,CAEH,mBAAO,oBAAC,KAAK,CAAC,QAAQ,MAAEA,GAAG,CAAkB,CAC/C,CAAC,oBAlGkBlC,KAAK,CAACqC,SAAS,EAuGpC,GAAMC,gBAAe,CAAG,QAAlBA,gBAAe,CAAIb,KAAK,QAAM,CAClCI,eAAe,CAAEJ,KAAK,CAACI,eAAe,CACtCvB,QAAQ,CAAEmB,KAAK,CAACnB,QAClB,CAAC,EAAC,CAEF,GAAMiC,mBAAkB,CAAG,CACzBrC,eAAe,CAAfA,eACF,CAAC,CAED,cAAeD,QAAO,CAACqC,eAAe,CAAEC,kBAAkB,CAAC,CAACpC,MAAM,CAAC"},"metadata":{},"sourceType":"module"}